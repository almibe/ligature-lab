---
import Layout from '../layouts/Layout.astro';
import '../main.css';
import '@shoelace-style/shoelace/dist/themes/light.css';
import { getSession } from 'auth-astro/server';
import { Editor } from '../components/Editor.tsx';

const session = await getSession(Astro.request);
const loggedIn = session != null
let userName = undefined
if (loggedIn) {
	userName = session.user?.email
}
---

<Layout title="Ligature Lab">
	<header>
		<h1>Ligature Lab</h1>
		{ loggedIn && <div class="content" id="user">Hello, {userName} &dash; <button id="signOut">Logout</button></div><div><img src="./terminal.svg" alt="Terminal"></sl-icon-button>
		</div> }
	</header>

	{ loggedIn && <Editor client:only="solid" /> }
	{ !loggedIn && <p>Not signed in.</p><button id="login">Login with GitHub</button> }

	<script>
	  const { signIn, signOut } = await import("auth-astro/client")
	  const login = document.querySelector("#login");
	  if (login != null) {
		login.onclick = () => signIn("github")
	  }
	  const logout = document.querySelector("#signOut")
	  if (logout != null) {
		logout.onclick = () => signOut()
	  }
	</script>
</Layout>
